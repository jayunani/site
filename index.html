<!doctype html>
<html>
<head>
	<meta charset="utf-8" >
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<title>Food Oasis LA</title>
	
	<link href="https://fonts.googleapis.com/css?family=Reem+Kufi" rel="stylesheet">
	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<link rel="stylesheet" href="css/oasis.css" />

	<!-- Need the following files to enable Mapbox -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.3.0/mapbox-gl-geocoder.css' type='text/css' />
	
</head>
<body>
	<nav>
		<h1><img src="images/food-oasis-la.svg" width="300" alt="Food Oasis LA" /></h1>
	</nav>

	<div class="header">
		<p>
			<a href="about/">
				<img class="icon" src="images/icons/info.svg" width="30" alt="" />
				About this project
			</a>
		</p>
	</div>

	<!--
	<form action="" method="post">
		<h2>Find food sources</h2>
		<p>
			<label>
				Enter your address<br />
				<input type="search" name="address" />
			</label>
			<button>Submit</button>
		</p>
	</form>
	-->

	<div id="map" class="mapbox"></div>
	<script src="leaflet/leaflet.js"></script>
	<script>
	
		mapboxgl.accessToken = 'pk.eyJ1IjoiZm9vZGRlc2VydHNsYSIsImEiOiJjaXByOXRscnMwNzY1Zm5ub3YwYTd5Z3dsIn0.DWgUhgW32pVkybKx7cWWiw';
		
		var map = new mapboxgl.Map({
			container: 'map', // container id
			style: 'mapbox://styles/fooddesertsla/ciqlgjsvb0001bkno0wkx8gg8', // stylesheet location
			center: [-118.243685, 34.052234], // starting position
			zoom: 9 // starting zoom
		});
	
		// Create a popup, but don't add it to the map yet.
		var popup = new mapboxgl.Popup({
			closeButton: false,
			closeOnClick: false
		});

		// Creates a popup on hover
		map.on('click', function(e) {
			var features = map.queryRenderedFeatures(e.point, { layers: ['Food Banks (Solution)','CG-UF-N (Solution)','Farmers Markets (Solution)','Groceries (Problem)'] });

			// Change the cursor style as a UI indicator.
			map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
			if (!features.length) {
				popup.remove();
				return;
			}

			var feature = features[0];
			console.log(feature);//Displays the contents as an array in the console log

			popup.setLngLat(feature.geometry.coordinates)
				.setHTML(
					"<p>"+feature.properties["NAME:"]+"</p>"+
					"<p>"+feature.properties["ADDRESS:"]+"</p>"+
					//"<p>"+feature.properties["CONTACT:"]+"</p>"+
					"<p> Hours: "+feature.properties["TIMES:"]+"</p>"+
					"<p><a href='details/'>Details</a></p>")
				.addTo(map);
		}); 

    	// Add Search Functionality
		map.addControl(new mapboxgl.Geocoder());

		// Add 'Current Location' Functionality
		map.addControl(new mapboxgl.Geolocate());

		//map.Geolocation.getCurrentPosition()
		//loc = map.getCenter();


		// BELOW is the wrong syntax, need to figure out how to get geolocated coordinates!!!
		// var newctr = new mapboxgl.getCenter();
		// var myLoc = mapboxgl.Marker().setLngLat(newctr).addTo(map);

	</script>
</body>
</html>